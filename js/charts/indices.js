//en este caso correspondiente a 3cm-co
let edoResultadosRecuperadoApi=`
<table class="genTbl reportTbl">
<tr class="alignBottom" id="header_row">
<th><span class="lightgrayFont arial_11 noBold">Periodo que termina:</span></th>
<th><span class="bold">2023</span><div class="noBold arial_11">30/06</div></th>
<th><span class="bold">2023</span><div class="noBold arial_11">31/03</div></th>
<th><span class="bold">2022</span><div class="noBold arial_11">31/12</div></th>
<th><span class="bold">2022</span><div class="noBold arial_11">30/09</div></th>
</tr>

<tbody>
<tr class="openTr pointer" id="parentTr">
<td><span class="bold">Ventas netas totales<span class="dropDownArrowLightGray"></span></span></td>
<td>8325</td>
<td>8031</td>
<td>8079</td>
<td>8619</td>
</tr><tr class="noHover" id="childTr"><td class="innerTD" colspan="5"><div><table class="genTbl reportTbl"><tbody> <tr class="child">
<td><span class="">Ventas Netas</span></td>
<td>8325</td>
<td>8031</td>
<td>8079</td>
<td>8619</td>
</tr> <tr class="child last">
<td><span class="">Otras ventas, Total</span></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr></tbody></table></div></td></tr> <tr>
<td><span class="">Costo de venta</span></td>
<td>4559</td>
<td>4597</td>
<td>4582</td>
<td>4728</td>
</tr> <tr>
<td><span class="bold">Utilidad bruta</span></td>
<td>3719</td>
<td>3434</td>
<td>3497</td>
<td>3891</td>
</tr> <tr class="openTr pointer" id="parentTr">
<td><span class="bold">Total de gastos de operación<span class="dropDownArrowLightGray"></span></span></td>
<td>6615</td>
<td>6707</td>
<td>7086</td>
<td>7122</td>
</tr><tr class="noHover" id="childTr"><td class="innerTD" colspan="5"><div><table class="genTbl reportTbl"><tbody> <tr class="child">
<td><span class="">Venta y administración General /Mantenimiento/ Renta de equipo, Total</span></td>
<td>1602</td>
<td>1642</td>
<td>2061</td>
<td>1933</td>
</tr> <tr class="child">
<td><span class="">Gastos de Investigación y Desarrollo</span></td>
<td>454</td>
<td>468</td>
<td>443</td>
<td>461</td>
</tr> <tr class="child">
<td><span class="">Depreciación / Amortización</span></td>
<td>571</td>
<td>344</td>
<td>346</td>
<td>326</td>
</tr> <tr class="child">
<td><span class="">Intereses pagados (Utilidad), Neto</span></td>
<td>-144</td>
<td>-123</td>
<td>-115</td>
<td>-106</td>
</tr> <tr class="child">
<td><span class="">Gastos extraordinarios (Utilidad)</span></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr> <tr class="child last">
<td><span class="">Otros gastos de Operación, Total</span></td>
<td>-427</td>
<td>-221</td>
<td>-231</td>
<td>-220</td>
</tr></tbody></table></div></td></tr> <tr>
<td><span class="bold">Utilidad de operación</span></td>
<td>1710</td>
<td>1324</td>
<td>993</td>
<td>1497</td>
</tr> <tr>
<td><span class="">Gastos por intereses neto + Participación en los resultados de compañías asociadas</span></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr> <tr>
<td><span class="">Utilidad en venta de activos fijos, neto</span></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>2724</td>
</tr> <tr>
<td><span class="">Otros, neto</span></td>
<td>10730</td>
<td>133</td>
<td>388</td>
<td>-5361</td>
</tr> <tr>
<td><span class="bold">Resultado antes de los impuestos a la utilidad</span></td>
<td>-9020</td>
<td>1191</td>
<td>605</td>
<td>4134</td>
</tr> <tr>
<td><span class="">Total de impuestos a la utilidad</span></td>
<td>-2184</td>
<td>210</td>
<td>62</td>
<td>271</td>
</tr> <tr>
<td><span class="bold">Resultado neto después de impuestos a la utilidad</span></td>
<td>-6836</td>
<td>981</td>
<td>543</td>
<td>3863</td>
</tr> <tr>
<td><span class="">Participación no controladora</span></td>
<td>-</td>
<td>53</td>
<td>48</td>
<td>76</td>
</tr> <tr>
<td><span class="">Participación en el resultado de de subsidiarias y asociadas</span></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr> <tr>
<td><span class="">Ajuste US PCGA (GAAP)</span></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr> <tr>
<td><span class="bold">Resultado antes de partidas extraordinarias</span></td>
<td>-6841</td>
<td>976</td>
<td>541</td>
<td>3859</td>
</tr> <tr>
<td><span class="">Total de partidas extraordinarias</span></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr> <tr>
<td><span class="bold">Resultado neto</span></td>
<td>-6841</td>
<td>976</td>
<td>541</td>
<td>3859</td>
</tr> <tr>
<td><span class="">Ajuste total al resultado Neto</span></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr> <tr>
<td><span class="bold">Ingreso disponible excluyendo partidas extraordinarias</span></td>
<td>-6841</td>
<td>976</td>
<td>541</td>
<td>3859</td>
</tr> <tr>
<td><span class="">Ajuste de dilución</span></td>
<td>-0.335</td>
<td>2.37</td>
<td>2.12</td>
<td>0.1</td>
</tr> <tr>
<td><span class="">Dilución de Utilidad neta</span></td>
<td>-6840.66</td>
<td>973.63</td>
<td>538.88</td>
<td>3858.9</td>
</tr> <tr>
<td><span class="">Dilución de promedio ponderado de acciones</span></td>
<td>553.9</td>
<td>553.2</td>
<td>552.9</td>
<td>570</td>
</tr> <tr>
<td><span class="bold">Dilución de las ganancias por acción excluyendo partidas extraordinarias</span></td>
<td>-12.35</td>
<td>1.76</td>
<td>0.975</td>
<td>6.77</td>
</tr> <tr>
<td><span class="">Dividendo por acción - Acciones Comunes distribución primaria</span></td>
<td>1.5</td>
<td>1.5</td>
<td>1.49</td>
<td>1.49</td>
</tr> <tr>
<td><span class="">Dilución de las ganancias por acción básicas</span></td>
<td>1.82</td>
<td>1.4</td>
<td>1.03</td>
<td>1.54</td>
</tr> </tbody>
</table>
`

//creamos un div temporal para similiar que es codigo html

let tempDiv=document.createElement('div')
tempDiv.innerHTML=edoResultadosRecuperadoApi;


//para graficar los indices de rentabilidad, liquidez, rotacion y endeudamiento sugiero que tomemos los datos del periodo
//mas reciente


//obtenemos todas las filas de la tabla
let rows = tempDiv.querySelectorAll('.genTbl.reportTbl tbody tr');

let datosFinancieros = {};

//iteramos a traves de las filas y obtemos los datos del periodo mas cercano

rows.forEach(row =>{
    let cells = row.querySelectorAll('td');
    if (cells.length > 1){
        let label = cells[0].textContent.trim();
        let value = parseFloat(cells[1].textContent.trim().replace(',',''));

        if(!isNaN(value)){
            datosFinancieros[label] = value;
        }
    }
})

//imprimimos los datos
console.log(datosFinancieros)

//AHORA CALCULAMOS LOS INDICES QUE NECESITAMOS

let indices = {
    rentabilidad: datosFinancieros["Resultado neto"] / datosFinancieros["Ventas Netas"],
    endeudamiento: datosFinancieros["Total de gastos de operación"] / datosFinancieros["Ventas Netas"],
    rotacion: datosFinancieros["Ventas Netas"] / datosFinancieros["Utilidad bruta"],
    liquidez: datosFinancieros["Utilidad bruta"] / datosFinancieros["Ventas Netas"]
};

console.log(indices);


//ahora graficamos los indices para esta empresa
let chart_indices = document.getElementById('myChartIndices').getContext('2d');
let myChart = new Chart(chart_indices, {
    type: 'bar',
    data: {
        labels: ['Rentabilidad', 'Endeudamiento', 'Rotación', 'Liquidez'],
        datasets: [{
            label: 'Índices Financieros',
            data: [indices.rentabilidad, indices.endeudamiento, indices.rotacion, indices.liquidez],
            backgroundColor: [
                'rgba(75, 192, 192, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(153, 102, 255, 0.2)'
            ],
            borderColor: [
                'rgba(75, 192, 192, 1)',
                'rgba(255, 99, 132, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(153, 102, 255, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

